#:import MDDropdownMenu kivymd.uix.menu.MDDropdownMenu

<WindowManager>:
    LoginWindow:
        name: 'login'
    CreateAccountWindow:
        name: 'create'
    MainWindow:
        name: 'welcome'
    LoadingPage:
        name: 'loading'
    JPGIsUploaded:
        name: 'jpguploaded'
    OCRComplete:
        name: 'ocrcomplete'
    HelpPage:
        id: helppg
        name: 'help'
<Dialogs@Screen>
    MDRaisedButton:
        text: "Open Ok Cancel Dialog"
        size_hint: None, None
        size: 3 * dp(48), dp(48)
        pos_hint: {'center_x': .5, 'center_y': .2}
        opposite_colors: True
        on_release:
            root.manager.current = 'login'
            app.Exitpopup_Example()

<LoginWindow>:
    email: email
    password: password

    FloatLayout:
        canvas:
            Rectangle:
                source: "waverunner_background.png"
                size: self.size
                pos: self.pos
        Button:
            #wssc logo
            background_color: 0,0,0,0
            pos_hint: {'x': -0.08, 'y': 0.8}
            size_hint_y: 0.2
            size_hint_x: 0.25
            on_release:
                root.manager.current = 'login'
            Image:
                source: 'semicircle.png'
                pos: self.parent.pos
                keep_ratio: False
                allow_stretch: False
                size: self.parent.size
        MDFloatingActionButton:
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            icon: 'help'
            pos_hint:{'x': 0.795, 'y': 0.91}
            md_bg_color: app.theme_cls.primary_color
            on_release:
                #app.helpBtn()
                root.manager.current = 'help'
                root.manager.ids.helppg.previous = root.name
        MDRaisedButton:
            text: 'Exit Application'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{'x': 0.84, 'y': 0.92}
            on_release:
                app.exit_app()

        FloatLayout:
            size: root.width, root.height/2

            MDLabel:
                halign: 'center'
                valign: 'middle'
                size_hint_y: 1.5
                font_style: 'H6'
                font_size: sp(64)
                text: 'Parkway Plant Data Recordation & Reporting Processes'
                #how does color work?
                color: 1,1,1,1
            MDLabel:
                text:"Email: "
                font_size: sp(50)
                pos_hint: {"x":0.3, "top": 0.64}
                size_hint: 0.1, 0.15
                color: 1,1,1,1
            TextInput:
                id: email
                font_size: (root.width**2 + root.height**2) / 16**4
                pos_hint: {'x': 0.4, 'top': 0.62}
                size_hint: 0.5, 0.12
                write_tab: False
                multiline: False
                on_text_validate: password.focus = True
            MDLabel:
                text:"Password: "
                font_size: sp(45)
                pos_hint: {"x":0.254, "top": 0.49}
                size_hint: 0.5, 0.15
                color: 1,1,1,1
            TextInput:
                id: password
                font_size: (root.width**2 + root.height**2) / 16**4
                pos_hint: {'x': 0.4, 'top': 0.47}
                size_hint: 0.5, 0.12
                multiline: False
                password: True
                on_text_validate:
                    root.manager.transition.direction = "up"
                    root.loginBtn()
            MDRaisedButton:
                pos_hint:{"x":0.35,"y":0.15}
                size_hint: 0.3, 0.1
                font_size: sp(40)
                elevation_normal: 12
                text: "Login"
                text_color: 1,1,1,1
                on_release:
                    root.manager.transition.direction = "up"
                    root.loginBtn()
            MDRaisedButton:
                pos_hint:{"x":0.4,"y":0.05}
                size_hint: 0.2, 0.05
                font_size: sp(16)
                elevation_normal: 12
                text: "Don't have an Account? Create One"
                text_color: 1,1,1,1
                on_release:
                    root.manager.transition.direction = "right"
                    root.createBtn()

<CreateAccountWindow>:
    namee: namee
    email: email
    password: passw

    FloatLayout:
        canvas:
            Rectangle:
                source: "waverunner_background.png"
                size: self.size
                pos: self.pos
        Button:
            #wssc logo
            background_color: 0,0,0,0
            pos_hint: {'x': -0.08, 'y': 0.8}
            size_hint_y: 0.2
            size_hint_x: 0.25
            on_release:
                root.manager.current = 'login'
            Image:
                source: 'semicircle.png'
                pos: self.parent.pos
                keep_ratio: False
                allow_stretch: False
                size: self.parent.size
        MDFloatingActionButton:
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            icon: 'help'
            pos_hint:{'x': 0.795, 'y': 0.91}
            md_bg_color: app.theme_cls.primary_color
            on_release:
                root.manager.current = 'help'
                root.manager.ids.helppg.previous = root.name
        MDRaisedButton:
            text: 'Exit Application'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{'x': 0.84, 'y': 0.92}
            on_release:
                app.exit_app()

        FloatLayout:
            size: root.width, root.height/2

            MDLabel:
                text: "Create an Account"
                text_color: 1,1,1,1
                halign: 'center'
                valign: 'middle'
                size_hint_y: 1.75
                font_style: 'H6'
                font_size: sp(60)
                color: 1,1,1,1
            MDLabel:
                size_hint: 0.5,0.12
                pos_hint: {"x":0.2, "top":0.75}
                font_size: sp(30)
                text: "Name: "
                color: 1,1,1,1
            TextInput:
                id: namee
                pos_hint: {"x":0.4, "top":0.75}
                size_hint: 0.5, 0.12
                font_size: (root.width**2 + root.height**2) / 16**4
                multiline: False
            MDLabel:
                size_hint: 0.5,0.12
                pos_hint: {"x":0.2, "top":0.75-0.13}
                font_size: sp(30)
                text: "Email: "
                color: 1,1,1,1
            TextInput:
                id: email
                pos_hint: {"x":0.4, "top":0.75-0.13}
                size_hint: 0.5, 0.12
                font_size: (root.width**2 + root.height**2) / 16**4
                multiline: False
            MDLabel:
                size_hint: 0.5,0.12
                pos_hint: {"x":0.2, "top":0.75-0.13*2}
                font_size: sp(30)
                text: "Password: "
                color: 1,1,1,1
            TextInput:
                id: passw
                pos_hint: {"x":0.4, "top":0.75-0.13*2}
                size_hint: 0.5, 0.12
                font_size: (root.width**2 + root.height**2) / 16**4
                multiline: False
                password: True
            MDRaisedButton:
                pos_hint:{"x":0.25,"y":0.2}
                size_hint: 0.5, 0.1
                font_size: sp(16)
                elevation_normal: 12
                text: "Already have an Account? Log In"
                text_color: 1,1,1,1
                on_release:
                    root.manager.transition.direction = "left"
                    root.login()
            MDRaisedButton:
                pos_hint:{"x":0.35,"y":0.05}
                size_hint: 0.3, 0.1
                font_size: sp(18)
                elevation_normal: 12
                text: "Submit"
                text_color: 1,1,1,1
                on_release:
                    root.manager.transition.direction = "left"
                    root.submit()

#how do I make this item call a function from inside MainWindow? That might allow me a variable to be used...
<MDMenuItem>:
    on_release:
        app.root.get_screen("welcome").change_variable(self.text)

<MainWindow>:
    FloatLayout:
        canvas:
            Rectangle:
                source: "waverunner_background.png"
                size: self.size
                pos: self.pos
        Button:
            #wssc logo
            background_color: 0,0,0,0
            pos_hint: {'x': -0.08, 'y': 0.8}
            size_hint_y: 0.2
            size_hint_x: 0.25
            on_release:
                root.manager.current = 'login'
            Image:
                source: 'semicircle.png'
                pos: self.parent.pos
                keep_ratio: False
                allow_stretch: False
                size: self.parent.size
        MDFloatingActionButton:
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            icon: 'help'
            pos_hint:{'x': 0.795, 'y': 0.91}
            md_bg_color: app.theme_cls.primary_color
            on_release:
                root.manager.current = 'help'
                root.manager.ids.helppg.previous = root.name
        MDRaisedButton:
            text: 'Exit Application'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{'x': 0.84, 'y': 0.92}
            on_release:
                app.exit_app()

        FloatLayout:
            size: root.width, root.height/2
            MDLabel:
                halign: 'center'
                valign: 'middle'
                size_hint_y: 1.55
                font_style: 'H6'
                font_size: sp(64)
                text: 'Parkway Plant Data Recordation & Reporting Processes'
                color: 1,1,1,1
            MDLabel:
                halign: 'center'
                valign: 'middle'
                size_hint_y: 1.1
                font_style: 'H4'
                font_size: sp(45)
                text: 'Which form are you uploading?'
                color: 1,1,1,1
            MDRaisedButton:
                font_size: sp(30)
                text: 'Open menu'
                elevation_normal: 6
                pos_hint: {'center_x': .5, 'center_y': .45}
                on_release:
                    MDDropdownMenu(items=root.menu_items, width_mult=4).open(self)
            MDLabel:
                id: fileselection
                halign: 'center'
                valign: 'middle'
                size_hint_y: 1
                font_size: sp(30)
                color: 1,1,1,1
            MDRaisedButton:
                text_color: 1,1,1,1
                font_size: sp(30)
                elevation_normal: 12
                pos_hint:{"center_x":0.5,"y":0.1}
                text: "Upload JPG File"
                on_release:
                    app.open_file()
                    root.changeScreen()
                    root.manager.transition.direction = "down"

<LoadingPage>:

    FloatLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size

        AnchorLayout:
            anchor_x: 'center'
            anchor_y: 'center'

            Image:
                id: loadingicon
                source: "load_anim.gif"


<JPGIsUploaded>:

    FloatLayout:
        canvas:
            Rectangle:
                source: "waverunner_background.png"
                size: self.size
                pos: self.pos
        Button:
            #wssc logo
            background_color: 0,0,0,0
            pos_hint: {'x': -0.08, 'y': 0.8}
            size_hint_y: 0.2
            size_hint_x: 0.25
            on_release:
                root.manager.current = 'login'
            Image:
                source: 'semicircle.png'
                pos: self.parent.pos
                keep_ratio: False
                allow_stretch: False
                size: self.parent.size
        MDFloatingActionButton:
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            icon: 'help'
            pos_hint:{'x': 0.795, 'y': 0.91}
            md_bg_color: app.theme_cls.primary_color
            on_release:
                root.manager.current = 'help'
                root.manager.ids.helppg.previous = root.name
        MDRaisedButton:
            text: 'Exit Application'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{'x': 0.84, 'y': 0.92}
            on_release:
                app.exit_app()

        AnchorLayout:
            size: root.width, root.height/2
            Image:
                id: image
                source: ''
                size_hint: 0.65, 0.65

        MDRaisedButton:
            text: 'Upload different JPG file'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{"center_x":0.35,"y":0.1}
            on_release:
                app.open_file()
                root.assign_image
        MDRaisedButton:
            text: 'Convert Data with OCR'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{"center_x":0.65,"y":0.1}
            on_release:
                root.manager.current = 'loading'

<OCRComplete>:

    FloatLayout:
        canvas:
            Rectangle:
                source: "waverunner_background.png"
                size: self.size
                pos: self.pos
        Button:
            #wssc logo
            background_color: 0,0,0,0
            pos_hint: {'x': -0.08, 'y': 0.8}
            size_hint_y: 0.2
            size_hint_x: 0.25
            on_release:
                root.manager.current = 'login'
            Image:
                source: 'semicircle.png'
                pos: self.parent.pos
                keep_ratio: False
                allow_stretch: False
                size: self.parent.size
        MDFloatingActionButton:
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            icon: 'help'
            pos_hint:{'x': 0.795, 'y': 0.91}
            md_bg_color: app.theme_cls.primary_color
            on_release:
                root.manager.current = 'help'
                root.manager.ids.helppg.previous = root.name
        MDRaisedButton:
            text: 'Exit Application'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{'x': 0.84, 'y': 0.92}
            on_release:
                app.exit_app()

        TabbedPanel:
            size_hint: .75, .75
            pos_hint: {'center_x': .5, 'center_y': .5}
            do_default_tab: False
            tab_width: self.parent.width / 5
            tab_pos: 'top_right'
            background_color: 0,0,0,0
            TabbedPanelItem:
                text: 'OCR File'
                pos_hint: {'x': 0.35, 'y': 0.25}
                background_color: .25,1,.25,.5
#                Image:
#                    id: results
#                    source: ''
#                    keep_ratio: False
                MDLabel:
                    id: input
                    multiline: True
            TabbedPanelItem:
                text: 'Scanned Image'
                background_color: .25,1,.25,.5
                Image:
                    id: iimage
                    source: ''
                    keep_ratio: False

    FloatLayout:
        size: root.width, root.height/2
        MDRaisedButton:
            text: 'Edit'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{"center_x":0.35,"y":0.05}
            on_release:
                root.edit_file()
        MDRaisedButton:
            text: 'Save File'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{"center_x":0.65,"y":0.05}
            on_release:
                app.save_file()
                root.manager.current = 'login'
                root.manager.transition.direction = 'up'

<HelpPage>:
    FloatLayout:
        canvas:
            Rectangle:
                source: "waverunner_background.png"
                size: self.size
                pos: self.pos
        Button:
            #wssc logo
            background_color: 0,0,0,0
            pos_hint: {'x': -0.08, 'y': 0.8}
            size_hint_y: 0.2
            size_hint_x: 0.25
            on_release:
                root.manager.current = 'login'
            Image:
                source: 'semicircle.png'
                pos: self.parent.pos
                keep_ratio: False
                allow_stretch: False
                size: self.parent.size
        MDFloatingActionButton:
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            icon: 'help'
            pos_hint:{'x': 0.795, 'y': 0.91}
            md_bg_color: app.theme_cls.primary_color
            on_release:
                root.manager.current = 'help'
        MDRaisedButton:
            text: 'Exit Application'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{'x': 0.84, 'y': 0.92}
            on_release:
                app.exit_app()

    FloatLayout:
        size: root.width, root.height/2
        MDLabel:
            halign: 'center'
            valign: 'middle'
            size_hint_y: 1.85
            font_style: 'H6'
            font_size: sp(72)
            text: 'Welcome to the help page!'
            color: 1,1,1,1
        MDLabel:
            halign: 'center'
            valign: 'middle'
            size_hint_y: 1.45
            font_style: 'H3'
            font_size: sp(36)
            text: 'Why are there weird values in my .CSV file?'
            color: 1,1,1,1
        MDLabel:
            halign: 'center'
            valign: 'middle'
            size_hint_y: 1.25
            font_style: 'H1'
            font_size: sp(24)
            text: ' These numbers are part of the flagging system--they mean that there was an error processing that number. This might be because: a) the program could not read your handwriting b) the number was out of bounds or c) the program could not process that set. '
            color: 0,0,0,1
        MDLabel:
            halign: 'center'
            valign: 'middle'
            size_hint_y: 1.05
            font_style: 'H3'
            font_size: sp(30)
            text: 'What do I do?'
            color: 1,1,1,1
        MDLabel:
            halign: 'center'
            valign: 'middle'
            size_hint_y: 0.8
            font_style: 'H1'
            font_size: sp(24)
            text: ' Machine learning is not 100% accurate; there will always be errors. If it is just a few values, we recommend using the Edit button to manually correct the fields. If there are a lot of errors, it may be better to try rescanning the file. If errors persist, and this is not normal, please contact the IT department at 301-316-8243. '
            color: 0,0,0,1
        MDRaisedButton:
            text: 'Back'
            text_color: 1,1,1,1
            font_size: sp(30)
            elevation_normal: 12
            pos_hint:{"center_x":0.5,"y":0.05}
            on_release:
                root.manager.current = root.previous
